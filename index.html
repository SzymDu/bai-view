<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>System zarzÄ…dzania</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue-chartjs/dist/vue-chartjs.min.js"></script>
    <script src='https://code.jquery.com/jquery-1.12.3.js'></script>
    <script src='https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js'></script>
    <script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js" charset="utf-8"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.1.0/css/responsive.bootstrap.min.css">
    <script>

    </script>
</head>
<body>

<div id="app">
    <information-table :data="employees"
                       v-if="renderComponent"
    >

    </information-table>
</div>

<script>

    Vue.component('information-table', {
        template: `
          <div class="table-wrapper-scroll-y my-custom-scrollbar">
      <table id="dataTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
        <tr>
          <th class="th-sm">Id</th>
          <th class="th-sm">Imie</th>
          <th class="th-sm">Nazwisko</th>
          <th class="th-sm">Adres</th>
          <th class="th-sm">Email</th>
          <th class="th-sm">Wiek</th>
          <th class="th-sm">Plec</th>
          <th class="th-sm">Wynagrodzenie</th>
          <th class="th-sm">Rola</th>
          <th class="th-sm">Usun</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="user in data" :key='user.id'>
          <td>{{user.id}}</td>
          <td>{{user.name}}</td>
          <td>{{user.surname}}</td>
          <td>{{user.adress}}</td>
          <td>{{user.email}}</td>
          <td>{{user.age}}</td>
          <td>{{user.gender}}</td>
          <td>{{user.pension}}</td>
          <td>{{user.role}}</td>
          <td v-on:click="test(user.id)"><button>Usun</button></td>
        </tr>
        </tbody>
      </table>
          </div>
`, props: ['data'],
        methods: {
            test: function(id){
                this.$root.removeUser(id);
                this.forceRerender();
            },
            forceRerender() {
                this.$root.updateComponent();
            }
        },
    });
    var app = new Vue({
        el: '#app',
        data:{
            employees: [],
            renderComponent: true,
        },
        mounted () {
            axios.get('http://localhost:8082/employees')
                .then(response => this.employees = (response.data))
                .then(() => {
                    $(document).ready(function () {
                        $("#dataTable").DataTable({

                        });
                    });
                })

        },
        methods: {
            removeUser: function(id){
                axios.delete('http://localhost:8082/employee?id='+id)
                    .then(response => this.employees = response.data)
                .then(() => this.updateComponent)
                    .then(() => {
                        $(document).ready(function () {
                            $("#dataTable").DataTable({

                            });
                        });
                    })
            },
            updateComponent: function (){
                this.renderComponent = false;
                this.$nextTick(() => {
                    this.renderComponent = true;
                    let dataTable = $("#dataTable").DataTable({

                    });
                });
            }
        },
    });

</script>

</body>
</html>